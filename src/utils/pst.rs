use chess::{BitBoard, Color};

pub struct PSTRefs<'a> {
    pub pawn: &'a [f32; 64],
    pub knight: &'a [f32; 64],
    pub bishop: &'a [f32; 64],
    pub rook: &'a [f32; 64],
    pub queen: &'a [f32; 64],
    pub king: &'a [f32; 64],
}

#[inline(always)]
pub fn sum_pst(bitboard: BitBoard, table: &[f32; 64]) -> f32 {
    let mut total = 0.0;
    for sq in bitboard {
        total += table[sq.to_index()];
    }
    total
}

pub fn get_pst(color: Color) -> PSTRefs<'static> {
    match color {
        Color::White => PSTRefs {
            pawn: &WHITE_PAWN_PST,
            knight: &WHITE_KNIGHT_PST,
            bishop: &WHITE_BISHOP_PST,
            rook: &WHITE_ROOK_PST,
            queen: &WHITE_QUEEN_PST,
            king: &WHITE_KING_PST,
        },
        Color::Black => PSTRefs {
            pawn: &BLACK_PAWN_PST,
            knight: &BLACK_KNIGHT_PST,
            bishop: &BLACK_BISHOP_PST,
            rook: &BLACK_ROOK_PST,
            queen: &BLACK_QUEEN_PST,
            king: &BLACK_KING_PST,
        },
    }
}

const fn invert_pst(source: &[f32; 64]) -> [f32; 64] {
    let mut table = [0.0; 64];
    let mut i = 0;
    while i < 64 {
        table[i] = -source[63 - i];
        i += 1;
    }
    table
}

const WHITE_PAWN_PST: [f32; 64] = [
    0.0, 0.0, 0.0, -0.5, -0.5, 0.0, 0.0, 0.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 1.0, 1.0,
    2.0, 3.0, 3.0, 2.0, 1.0, 1.0, 0.5, 0.5, 1.0, 2.5, 2.5, 1.0, 0.5, 0.5, 0.0, 0.0, 0.0, 2.0, 2.0,
    0.0, 0.0, 0.0, 0.5, -0.5, -1.0, 0.0, 0.0, -1.0, -0.5, 0.5, 0.5, 1.0, 1.0, -2.0, -2.0, 1.0, 1.0,
    0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
];
const BLACK_PAWN_PST: [f32; 64] = invert_pst(&WHITE_PAWN_PST);

const WHITE_KNIGHT_PST: [f32; 64] = [
    -5.0, -14.0, -2.0, -2.0, -2.0, -2.0, -14.0, -5.0, -4.0, -3.0, 0.0, 0.5, 0.5, 0.0, -3.0, -4.0,
    -2.0, 0.5, 1.0, 1.0, 1.0, 1.0, 0.5, -2.0, -2.0, 0.0, 1.0, 2.0, 2.0, 1.0, 0.0, -2.0, -2.0, 0.0,
    1.0, 2.0, 2.0, 1.0, 0.0, -2.0, -2.0, 0.5, 1.0, 1.0, 1.0, 1.0, 0.5, -2.0, -4.0, -2.0, 0.0, 0.5,
    0.5, 0.0, -2.0, -4.0, -5.0, -4.0, -2.0, -2.0, -2.0, -2.0, -4.0, -5.0,
];
const BLACK_KNIGHT_PST: [f32; 64] = invert_pst(&WHITE_KNIGHT_PST);

const WHITE_BISHOP_PST: [f32; 64] = [
    -2.0, -1.0, -11.0, -1.0, -1.0, -11.0, -1.0, -2.0, -1.0, -0.5, 0.0, 0.0, 0.0, 0.0, -0.5, -1.0,
    -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 0.0, -1.0, -1.0, 0.5,
    0.5, 1.0, 1.0, 0.5, 0.5, -1.0, -1.0, 0.0, 0.5, 1.0, 1.0, 0.5, 0.0, -1.0, -1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, -1.0, -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0,
];
const BLACK_BISHOP_PST: [f32; 64] = invert_pst(&WHITE_BISHOP_PST);

const WHITE_ROOK_PST: [f32; 64] = [
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.5, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.5, -0.5, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, -0.5, -0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.5, -0.5, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, -0.5, -0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -0.5, -0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    -0.5, 0.0, 0.0, 0.0, 0.5, 0.5, 0.0, 0.0, 0.0,
];
const BLACK_ROOK_PST: [f32; 64] = invert_pst(&WHITE_ROOK_PST);

const WHITE_QUEEN_PST: [f32; 64] = [
    -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0, -1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0, -1.0,
    0.5, 0.5, 0.5, 0.5, 0.5, 0.0, -1.0, -0.5, 0.0, 0.5, 0.5, 0.5, 0.5, 0.0, -0.5, -0.5, 0.0, 0.5,
    0.5, 0.5, 0.5, 0.0, -0.5, -1.0, 0.5, 0.5, 0.5, 0.5, 0.5, 0.0, -1.0, -1.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, -1.0, -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0,
];
const BLACK_QUEEN_PST: [f32; 64] = invert_pst(&WHITE_QUEEN_PST);

const WHITE_KING_PST: [f32; 64] = [
    -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0, -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
    -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0, -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0,
    -2.0, -3.0, -3.0, -4.0, -4.0, -3.0, -3.0, -2.0, -1.0, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0, -1.0,
    2.0, 2.0, 0.0, 0.0, 0.0, 0.0, 2.0, 2.0, 2.0, 3.0, 1.0, 0.0, 0.0, 1.0, 3.0, 2.0,
];
const BLACK_KING_PST: [f32; 64] = invert_pst(&WHITE_KING_PST);
